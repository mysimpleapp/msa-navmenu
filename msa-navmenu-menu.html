<link rel="import" href="../mysimpleapp/mysimpleapp.pack.html"></link>
<template id="msa-navmenu-menu">
	<style>
		.buttons {
			position: absolute;
			top: 5px;
			right: 5px;
		}
		.icon {
			padding: 5px;
			outline: 0;
			width: 24px;
			height: 24px;
			border-radius: 3pt;
		}
		.icon:hover {
			box-shadow: 1pt 1pt 3pt 1pt #aaa;
			border-radius: 3pt;
		}
	</style>
	<span class="buttons" ?if="navmenu.editable && !navmenu.editing">
		<input ?onclick="edit()" class="icon" type="image" src='data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20fill%3D%22%23999%22%20viewBox%3D%220%200%201024%201024%22%3E%3Cpath%20d%3D%22M864%200c88.364%200%20160%2071.634%20160%20160%200%2036.020-11.91%2069.258-32%2096l-64%2064-224-224%2064-64c26.742-20.090%2059.978-32%2096-32zM64%20736l-64%20288%20288-64%20592-592-224-224-592%20592zM715.578%20363.578l-448%20448-55.156-55.156%20448-448%2055.156%2055.156z%22%2F%3E%3C%2Fsvg%3E'>
	</span>
	<span class="buttons" ?if="navmenu.editable && navmenu.editing">
		<input ?onclick="save()" class="icon" type="image" src='data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20fill%3D%22%23999%22%20viewBox%3D%220%200%201024%201024%22%3E%3Cpath%20d%3D%22M896%200h-896v1024h1024v-896l-128-128zM512%20128h128v256h-128v-256zM896%20896h-768v-768h64v320h576v-320h74.978l53.022%2053.018v714.982z%22%2F%3E%3C%2Fsvg%3E'>
		<input ?onclick="cancel()" class="icon" type="image" src='data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20fill%3D%22%23999%22%20viewBox%3D%220%200%201024%201024%22%3E%3Cpath%20d%3D%22M0%20779.247l279.279%20-279.279%20-279.279%20-279.279%20220.689%20-220.689%20279.279%20279.279%20279.279%20-279.279%20220.689%20220.689%20-279.279%20279.279%20279.279%20279.279%20-220.689%20220.689%20-279.279%20-279.279%20-279.279%20279.279z%22%2F%3E%3C%2Fsvg%3E'>
	</span>
</template>
<script>
(function() {
	var Scope = {
		edit : function() {
			// set to edition mode
			this.navmenu.editing = true
			var menu = this
			App.import('/bower_components/msa-edition/msa-edition.html', {next:function(){
				Edition.makeBoxable(menu.navmenu)
				Edition.makeResizable(menu.navmenu, "bottom")
			}})
		},
		cancel : function() {
			// cancel edition mode
			this.navmenu.editing = false
			Edition.cancel(this.navmenu)
		},
		save : function() {
			// remove edition mode
			this.navmenu.editing = false
			Edition.stop(this.navmenu)
			// write content of sheet in db
			App.post("/navmenu", {content:this.navmenu.innerHTML, style:this.navmenu.style.cssText||""})
		}
	}
	var bindMenu = function(menu, scope) {
		if(scope.navmenu.editable!==undefined) Bind(menu.shadowRoot, scope)
		else setTimeout(bindMenu, 10, menu, scope)
	}
	App.registerElement("msa-navmenu-menu", {shadow:"#msa-navmenu-menu", onattach: function(){
		
		var scope = Object.create(Scope)
		
		var dom = this
		while(dom.nodeType != 11) dom = dom.parentNode;
		scope.navmenu = dom.host
		
		bindMenu(this, scope)
	}})
})();
</script>
